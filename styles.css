// ================================
// TRADUCTIONS
// ================================

const translations = {
    fr: {
        nav_home: "Accueil",
        nav_about: "À propos",
        nav_team: "Équipe",
        nav_activities: "Activités",
        nav_contact: "Contact",
        login_btn: "Connexion",
        hero_title: "Bienvenue au Club Physique Tech",
        hero_description: "Explorez les merveilles de la physique et de la technologie avec une communauté passionnée d'étudiants et de chercheurs.",
        hero_cta: "Découvrir notre club",
        about_title: "À propos de nous",
        mission_title: "Notre Mission",
        mission_text: "Promouvoir l'apprentissage et la découverte dans les domaines de la physique et de la technologie à travers des activités pratiques, des conférences et des projets collaboratifs.",
        vision_title: "Notre Vision",
        vision_text: "Devenir le club de référence pour tous les passionnés de sciences physiques et technologiques, en créant un environnement d'apprentissage stimulant et innovant.",
        values_title: "Nos Valeurs",
        values_text: "Excellence académique, collaboration, innovation, curiosité scientifique et partage des connaissances sont au cœur de notre démarche éducative.",
        team_title: "Notre Équipe",
        member1_name: "Dr. Ahmed Benali",
        member1_role: "Président",
        member1_bio: "Docteur en Physique Quantique, passionné par la recherche en nanotechnologies et l'enseignement scientifique.",
        member2_name: "Fatima Zahra",
        member2_role: "Vice-Présidente",
        member2_bio: "Ingénieure en électronique, spécialisée dans les systèmes embarqués et l'intelligence artificielle.",
        member3_name: "Omar Taha",
        member3_role: "Secrétaire Général",
        member3_bio: "Étudiant en Master Physique Appliquée, responsable de l'organisation des événements et des activités du club.",
        member4_name: "Aicha Mansouri",
        member4_role: "Responsable Communication",
        member4_bio: "Doctorante en Physique des Matériaux, gère la communication et les relations extérieures du club.",
        activities_title: "Nos Activités",
        activity1_title: "🔬 Ateliers Pratiques",
        activity1_desc: "Des séances de travaux pratiques hebdomadaires sur diverses thématiques : optique, électronique, mécanique quantique, et plus encore.",
        activity1_when: "Tous les mercredis 14h-17h",
        activity2_title: "📚 Conférences",
        activity2_desc: "Conférences mensuelles animées par des experts du domaine, abordant les dernières avancées en physique et technologie.",
        activity2_when: "Premier vendredi de chaque mois 18h-20h",
        activity3_title: "🏆 Compétitions",
        activity3_desc: "Participation aux olympiades de physique, concours de robotique et défis technologiques nationaux et internationaux.",
        activity3_when: "Selon le calendrier des compétitions",
        activity4_title: "🔧 Projets de Recherche",
        activity4_desc: "Développement de projets de recherche collaboratifs entre étudiants et encadrement par des professeurs.",
        activity4_when: "Projets semestriels et annuels",
        when_label: "Quand :",
        contact_title: "Contactez-nous",
        address_title: "Adresse",
        address_text: "Faculté des Sciences Appliquées Nador<br>Université Mohammed Premier Oujda <br>Nador, Maroc",
        email_title: "Email",
        phone_title: "Téléphone",
        phone_hours: "Lun-Ven: 9h-17h",
        login_title: "Connexion",
        email_label: "Email:",
        password_label: "Mot de passe:",
        login_submit: "Se connecter",
        not_member: "Pas encore membre?",
        create_account: "Créer un compte",
        signup_title: "Créer un compte",
        firstname_label: "Prénom:",
        lastname_label: "Nom:",
        apogee_label: "Numéro d'Apogée:",
        cycle_label: "Cycle d'étude:",
        select_cycle: "Sélectionnez votre cycle",
        licence_option: "Licence",
        master_option: "Master",
        specialization_label: "Spécialisation:",
        signup_submit: "Créer le compte",
        already_member: "Déjà membre?",
        login_link: "Se connecter"
    },
    en: {
        nav_home: "Home",
        nav_about: "About",
        nav_team: "Team",
        nav_activities: "Activities",
        nav_contact: "Contact",
        login_btn: "Login",
        hero_title: "Welcome to Physics Tech Club",
        hero_description: "Explore the wonders of physics and technology with a passionate community of students and researchers.",
        hero_cta: "Discover our club",
        about_title: "About Us",
        mission_title: "Our Mission",
        mission_text: "Promote learning and discovery in physics and technology through hands-on activities, conferences, and collaborative projects.",
        vision_title: "Our Vision",
        vision_text: "Become the reference club for all physics and technology enthusiasts, creating a stimulating and innovative learning environment.",
        values_title: "Our Values",
        values_text: "Academic excellence, collaboration, innovation, scientific curiosity, and knowledge sharing are at the heart of our educational approach.",
        team_title: "Our Team",
        member1_name: "Dr. Ahmed Benali",
        member1_role: "President",
        member1_bio: "PhD in Quantum Physics, passionate about nanotechnology research and scientific education.",
        member2_name: "Fatima Zahra",
        member2_role: "Vice President",
        member2_bio: "Electronics engineer, specialized in embedded systems and artificial intelligence.",
        member3_name: "Omar Taha",
        member3_role: "General Secretary",
        member3_bio: "Master's student in Applied Physics, responsible for organizing club events and activities.",
        member4_name: "Aicha Mansouri",
        member4_role: "Communication Manager",
        member4_bio: "PhD student in Materials Physics, manages club communication and external relations.",
        activities_title: "Our Activities",
        activity1_title: "🔬 Practical Workshops",
        activity1_desc: "Weekly practical sessions on various topics: optics, electronics, quantum mechanics, and more.",
        activity1_when: "Every Wednesday 2pm-5pm",
        activity2_title: "📚 Conferences",
        activity2_desc: "Monthly conferences led by field experts, covering the latest advances in physics and technology.",
        activity2_when: "First Friday of each month 6pm-8pm",
        activity3_title: "🏆 Competitions",
        activity3_desc: "Participation in physics olympiads, robotics contests, and national and international technology challenges.",
        activity3_when: "According to competition calendar",
        activity4_title: "🔧 Research Projects",
        activity4_desc: "Development of collaborative research projects between students and supervision by professors.",
        activity4_when: "Semester and annual projects",
        when_label: "When:",
        contact_title: "Contact Us",
        address_title: "Address",
        address_text: "Faculty of Applied Sciences Nador<br>Mohammed Premier University Oujda<br>Nador, Morocco",
        email_title: "Email",
        phone_title: "Phone",
        phone_hours: "Mon-Fri: 9am-5pm",
        login_title: "Login",
        email_label: "Email:",
        password_label: "Password:",
        login_submit: "Sign In",
        not_member: "Not a member yet?",
        create_account: "Create an account",
        signup_title: "Create an Account",
        firstname_label: "First Name:",
        lastname_label: "Last Name:",
        apogee_label: "Apogee Number:",
        cycle_label: "Study Cycle:",
        select_cycle: "Select your cycle",
        licence_option: "Bachelor",
        master_option: "Master",
        specialization_label: "Specialization:",
        signup_submit: "Create Account",
        already_member: "Already a member?",
        login_link: "Sign In"
    },

    ar: {
        nav_home: "الرئيسية",
        nav_about: "حولنا",
        nav_team: "الفريق",
        nav_activities: "الأنشطة",
        nav_contact: "اتصل بنا",
        login_btn: "تسجيل الدخول",
        hero_title: "مرحباً بكم في نادي فيزياء تك",
        hero_description: "استكشفوا عجائب الفيزياء والتكنولوجيا مع مجتمع متحمس من الطلاب والباحثين.",
        hero_cta: "اكتشف ناديـنا",
        about_title: "حولنا",
        mission_title: "مهمتنا",
        mission_text: "تعزيز التعلم والاكتشاف في مجالات الفيزياء والتكنولوجيا من خلال الأنشطة العملية والمحاضرات والمشاريع التعاونية.",
        vision_title: "رؤيتنا",
        vision_text: "أن نصبح النادي المرجعي لجميع المهتمين بالعلوم الفيزيائية والتكنولوجية، من خلال إنشاء بيئة تعليمية محفزة ومبتكرة.",
        values_title: "قيمنا",
        values_text: "التميز الأكاديمي والتعاون والابتكار والفضول العلمي وتبادل المعرفة هي في صميم نهجنا التعليمي.",
        team_title: "فريقنا",
        member1_name: "د. أحمد بن علي",
        member1_role: "الرئيس",
        member1_bio: "دكتوراه في الفيزياء الكمية، شغوف بالبحث في تكنولوجيا النانو والتعليم العلمي.",
        member2_name: "فاطمة الزهراء",
        member2_role: "نائبة الرئيس",
        member2_bio: "مهندسة إلكترونيات، متخصصة في الأنظمة المدمجة والذكاء الاصطناعي.",
        member3_name: "عمر طه",
        member3_role: "الأمين العام",
        member3_bio: "طالب ماجستير في الفيزياء التطبيقية، مسؤول عن تنظيم فعاليات وأنشطة النادي.",
        member4_name: "عائشة منصوري",
        member4_role: "مسؤولة التواصل",
        member4_bio: "طالبة دكتوراه في فيزياء المواد، تدير التواصل والعلاقات الخارجية للنادي.",
        activities_title: "أنشطتنا",
        activity1_title: "🔬 ورش عملية",
        activity1_desc: "جلسات عملية أسبوعية حول مواضيع متنوعة: البصريات، الإلكترونيات، الميكانيكا الكمية، وأكثر.",
        activity1_when: "كل أربعاء 14:00-17:00",
        activity2_title: "📚 محاضرات",
        activity2_desc: "محاضرات شهرية يقدمها خبراء في المجال، تتناول آخر التطورات في الفيزياء والتكنولوجيا.",
        activity2_when: "أول جمعة من كل شهر 18:00-20:00",
        activity3_title: "🏆 مسابقات",
        activity3_desc: "المشاركة في أولمبياد الفيزياء ومسابقات الروبوتات والتحديات التكنولوجية الوطنية والدولية.",
        activity3_when: "حسب جدول المسابقات",
        activity4_title: "🔧 مشاريع بحثية",
        activity4_desc: "تطوير مشاريع بحثية تعاونية بين الطلاب وإشراف من الأساتذة.",
        activity4_when: "مشاريع فصلية وسنوية",
        when_label: "متى:",
        contact_title: "اتصل بنا",
        address_title: "العنوان",
        address_text: "كلية العلوم التطبيقية الناظور<br>جامعة محمد الأول وجدة<br>الناظور، المغرب",
        email_title: "البريد الإلكتروني",
        phone_title: "الهاتف",
        phone_hours: "الاثنين-الجمعة: 9ص-5م",
        login_title: "تسجيل الدخول",
        email_label: "البريد الإلكتروني:",
        password_label: "كلمة المرور:",
        login_submit: "دخول",
        not_member: "لست عضواً بعد؟",
        create_account: "إنشاء حساب",
        signup_title: "إنشاء حساب",
        firstname_label: "الاسم الأول:",
        lastname_label: "اسم العائلة:",
        apogee_label: "رقم أبوجي:",
        cycle_label: "دورة الدراسة:",
        select_cycle: "اختر دورتك",
        licence_option: "الإجازة",
        master_option: "الماجستير",
        specialization_label: "التخصص:",
        signup_submit: "إنشاء الحساب",
        already_member: "عضو بالفعل؟",
        login_link: "تسجيل الدخول"
    }
};

let currentLanguage = 'fr';

//==================================
// Fonction pour gérer la connexion
//==================================

function handleLogin(event) {
    event.preventDefault();
    console.log("handleLogin exécutée");

    const formData = new FormData(event.target);
    const email = formData.get('email');
    const password = formData.get('password');

    const validUsers = [
        { email: 'jalalelyandouzi2@gmail.com', password: 'Elynd@12' },
        { email: 'ahmed.benali@gmail.com', password: 'Physics2024!' },
        { email: 'fatima.zahra@gmail.com', password: 'TechClub@23' },
        { email: 'omar.taha@gmail.com', password: 'Science@456' }
    ];

    const user = validUsers.find(u => u.email === email && u.password === password);

    if (user) {
        // Connexion réussie
        closeModal();
        showLoginSuccess();
    } else {
        // Erreur de connexion - fermer le modal de connexion et afficher l'erreur
        document.getElementById('loginModal').style.display = 'none';
        showLoginError();
    }
}

//==============================================
// Fonction pour afficher le succès de connexion
//==============================================

function showLoginSuccess() {
    document.getElementById('loginSuccessModal').style.display = 'block';
    
    // Redirection vers Facebook après 3 secondes
    setTimeout(() => {
        window.location.href = 'https://facebook.com';
    }, 3000);
}

//=============================================
// Fonction pour afficher l'erreur de connexion
//=============================================

function showLoginError() {
    document.getElementById('loginErrorModal').style.display = 'block';
}

//=============================================
// Fonction pour toggle menu
//=============================================
document.addEventListener("DOMContentLoaded", () => {
    const menuToggle = document.getElementById("menu-toggle");
    const navLinks = document.getElementById("nav-links");

    menuToggle.addEventListener("click", () => {
        navLinks.classList.toggle("active");
        menuToggle.classList.toggle("active");
    });
});

function closeMenu() {
    document.getElementById("nav-links").classList.remove("active");
    document.getElementById("menu-toggle").classList.remove("active");
}

//=============================================
// Fonction pour réessayer la connexion
//=============================================

function retryLogin() {
    // Fermer le modal d'erreur
    document.getElementById('loginErrorModal').style.display = 'none';
    
    // Rouvrir le modal de connexion
    document.getElementById('loginModal').style.display = 'block';
    
    // Optionnel : vider les champs du formulaire
    document.getElementById('email').value = '';
    document.getElementById('password').value = '';
    
    // Optionnel : mettre le focus sur le champ email
    document.getElementById('email').focus();
}

// Fonction pour ouvrir le modal
function openModal() {
    document.getElementById('loginModal').style.display = 'block';
}

function closeModal() {
    // Fermer tous les modals
    const modals = document.querySelectorAll('.modal');
    modals.forEach(modal => {
        modal.style.display = 'none';
    });
}

// Fonction pour afficher le modal d'inscription
function showSignupModal() {
    closeModal();
    document.getElementById('signupModal').style.display = 'block';
}

// Fonction pour afficher le modal de connexion
function showLoginModal() {
    closeModal();
    document.getElementById('loginModal').style.display = 'block';
}

// Fonction pour gérer les spécialisations
function toggleSpecialization() {
    const cycle = document.getElementById('cycle').value;
    const licenceOptions = document.getElementById('licenceOptions');
    
    if (cycle === 'licence') {
        licenceOptions.style.display = 'block';
        // Rendre la spécialisation obligatoire pour licence
        const radioButtons = licenceOptions.querySelectorAll('input[type="radio"]');
        radioButtons.forEach(radio => {
            radio.required = true;
        });
    } else {
        licenceOptions.style.display = 'none';
        // Retirer l'obligation pour les autres cycles
        const radioButtons = licenceOptions.querySelectorAll('input[type="radio"]');
        radioButtons.forEach(radio => {
            radio.required = false;
            radio.checked = false;
        });
    }
}

// ================================
// FONCTIONS DE NAVIGATION
// ================================

function showSection(sectionName) {
    // Masquer toutes les sections
    const sections = document.querySelectorAll('.section');
    sections.forEach(section => {
        section.classList.remove('active');
    });
    
    // Masquer la section hero si on navigue vers une autre section
    const hero = document.getElementById('home');
    if (sectionName !== 'home') {
        hero.style.display = 'none';
    } else {
        hero.style.display = 'block';
    }
    
    // Afficher la section demandée
    if (sectionName !== 'home') {
        const targetSection = document.getElementById(sectionName);
        if (targetSection) {
            targetSection.classList.add('active');
        }
    }
    
    // Fermer les modals si ouverts
    closeModal();
}

// ================================
// FONCTIONS DE TRADUCTION
// ================================

function changeLanguage(lang) {
    currentLanguage = lang;
    
    // Mettre à jour les boutons de langue
    const langBtns = document.querySelectorAll('.lang-btn');
    langBtns.forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    // Appliquer les traductions
    const elementsToTranslate = document.querySelectorAll('[data-translate]');
    elementsToTranslate.forEach(element => {
        const key = element.getAttribute('data-translate');
        if (translations[lang] && translations[lang][key]) {
            if (element.innerHTML.includes('<br>')) {
                element.innerHTML = translations[lang][key];
            } else {
                element.textContent = translations[lang][key];
            }
        }
    });
}

// ================================
// FONCTIONS MODALS SUPPLÉMENTAIRES
// ================================

function showSuccessModal() {
    document.getElementById('signupModal').style.display = 'none';
    document.getElementById('loginModal').style.display = 'none';
    document.getElementById('successModal').style.display = 'block';
}

// ================================
// GESTION DES FORMULAIRES
// ================================

function handleSignup(event) {
    event.preventDefault();
    
    const submitButton = event.target.querySelector('.form-submit');
    const originalText = submitButton.textContent;
    
    // Désactiver le bouton et afficher le loading
    submitButton.disabled = true;
    submitButton.classList.add('loading');
    
    const formData = new FormData(event.target);
    const userData = {
        firstName: formData.get('firstName'),
        lastName: formData.get('lastName'),
        apogeeNumber: formData.get('apogeeNumber'),
        email: formData.get('email'),
        password: formData.get('password'),
        cycle: formData.get('cycle'),
        specialization: formData.get('specialization')
    };
    
    // Validation des données
    if (!userData.firstName || !userData.lastName || !userData.email || !userData.password) {
        alert('Veuillez remplir tous les champs obligatoires');
        submitButton.disabled = false;
        submitButton.classList.remove('loading');
        return;
    }
    
    if (userData.cycle === 'licence' && !userData.specialization) {
        alert('Veuillez sélectionner une spécialisation pour le cycle Licence');
        submitButton.disabled = false;
        submitButton.classList.remove('loading');
        return;
    }
    
    // Simuler l'envoi des données
    setTimeout(function() {
        console.log('Données d\'inscription:', userData);
        
        // Réactiver le bouton
        submitButton.disabled = false;
        submitButton.classList.remove('loading');
        
        // Afficher le modal de succès
        showSuccessModal();
        
        // Rediriger vers la page "À propos" après 3 secondes
        setTimeout(function() {
            closeModal();
            showSection('about');
        }, 3000);
        
    }, 2000); // Simulation d'un délai d'envoi
}

// ================================
// ÉVÉNEMENTS
// ================================

// Fermer les modals en cliquant à l'extérieur
window.onclick = function(event) {
    const loginModal = document.getElementById('loginModal');
    const signupModal = document.getElementById('signupModal');
    const successModal = document.getElementById('successModal');
    const loginSuccessModal = document.getElementById('loginSuccessModal');
    const loginErrorModal = document.getElementById('loginErrorModal');
    
    if (event.target === loginModal) {
        loginModal.style.display = 'none';
    }
    if (event.target === signupModal) {
        signupModal.style.display = 'none';
    }
    if (event.target === successModal) {
        successModal.style.display = 'none';
    }
    if (event.target === loginSuccessModal) {
        loginSuccessModal.style.display = 'none';
    }
    if (event.target === loginErrorModal) {
        loginErrorModal.style.display = 'none';
    }
}

// Fermer les modals avec la touche Échap
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        closeModal();
    }
});

// ================================
// INITIALISATION
// ================================

document.addEventListener('DOMContentLoaded', function() {
    // Afficher la section d'accueil par défaut
    showSection('home');
    
    // Appliquer la traduction française par défaut
    changeLanguage('fr');
    
    console.log('Site Physique Tech initialisé avec succès!');
});

// Fonction pour ouvrir la modal de connexion
function openModal() {
    document.getElementById('loginModal').style.display = 'flex';
}

// Fonction pour fermer toutes les modals
function closeModal() {
    document.getElementById('loginModal').style.display = 'none';
    document.getElementById('signupModal').style.display = 'none';
    document.getElementById('successModal').style.display = 'none';
    document.getElementById('loginSuccessModal').style.display = 'none';
    document.getElementById('loginErrorModal').style.display = 'none';
}

// Fonction pour afficher la modal d'inscription
function showSignupModal() {
    document.getElementById('loginModal').style.display = 'none';
    document.getElementById('signupModal').style.display = 'flex';
}

// Fonction pour afficher la modal de connexion
function showLoginModal() {
    document.getElementById('signupModal').style.display = 'none';
    document.getElementById('loginModal').style.display = 'flex';
}

// Fonction pour basculer les options de spécialisation
function toggleSpecialization() {
    const cycle = document.getElementById('cycle').value;
    const licenceOptions = document.getElementById('licenceOptions');
    
    if (cycle === 'licence') {
        licenceOptions.style.display = 'block';
        // Rendre les boutons radio requis si licence est sélectionnée
        const radioButtons = licenceOptions.querySelectorAll('input[type="radio"]');
        radioButtons.forEach(radio => radio.required = true);
    } else {
        licenceOptions.style.display = 'none';
        // Retirer l'exigence et décocher les boutons radio
        const radioButtons = licenceOptions.querySelectorAll('input[type="radio"]');
        radioButtons.forEach(radio => {
            radio.required = false;
            radio.checked = false;
        });
    }
}

// Gestion de la soumission du formulaire d'inscription
document.addEventListener('DOMContentLoaded', function() {
    const signupForm = document.getElementById('signupForm');
    
    if (signupForm) {
        signupForm.addEventListener('submit', function(e) {
            // Vérifier si une spécialisation est sélectionnée pour licence
            const cycle = document.getElementById('cycle').value;
            if (cycle === 'licence') {
                const specialisation = document.querySelector('input[name="Spécialisation"]:checked');
                if (!specialisation) {
                    e.preventDefault();
                    alert('Veuillez sélectionner une spécialisation pour le cycle Licence.');
                    return;
                }
            }
            
            // Fermer la modal d'inscription avant la soumission
            document.getElementById('signupModal').style.display = 'none';
            
            // Afficher la modal de succès
            document.getElementById('successModal').style.display = 'flex';
            
            // Optionnel : redirection après 3 secondes
            setTimeout(function() {
                // Le formulaire sera soumis automatiquement grâce à FormSubmit
                // La redirection se fera via le champ _next de FormSubmit
            }, 3000);
        });
    }
});

// Fonction pour réessayer la connexion
function retryLogin() {
    document.getElementById('loginErrorModal').style.display = 'none';
    document.getElementById('loginModal').style.display = 'flex';
}

// Fermer les modals en cliquant à l'extérieur
window.onclick = function(event) {
    const modals = ['loginModal', 'signupModal', 'successModal', 'loginSuccessModal', 'loginErrorModal'];
    modals.forEach(modalId => {
        const modal = document.getElementById(modalId);
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    });
}

// Fonctions de navigation (si vous en avez besoin)
function showSection(sectionId) {
    // Masquer toutes les sections
    const sections = document.querySelectorAll('.section, .hero');
    sections.forEach(section => {
        section.style.display = 'none';
    });
    
    // Afficher la section demandée
    const targetSection = document.getElementById(sectionId);
    if (targetSection) {
        targetSection.style.display = 'block';
    }
}

// Initialiser l'affichage de la page d'accueil
document.addEventListener('DOMContentLoaded', function() {
    showSection('home');
});
